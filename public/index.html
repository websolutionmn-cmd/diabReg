<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DIAB-REG Application</title>
  <style>
    :root {
      --primary: #1d4ed8;          /* EU сина */
      --primary-light: #60a5fa;
      --secondary: #0ea5e9;
      --accent: #f97316;
      --light: #f3f4f6;
      --dark: #0f172a;
      --muted: #6b7280;
      --card-shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
      --card-shadow-hover: 0 22px 50px rgba(15, 23, 42, 0.18);
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      margin: 0; 
      padding: 0;
      background: radial-gradient(circle at top, #e5edff 0, #f9fafb 40%, #edf2ff 100%);
      color: var(--dark);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    .wrapper {
      max-width: 1200px;
      margin: 0 auto;
      background: #ffffff;
      min-height: 100vh;
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
    }

    @media (min-width: 768px) {
      .wrapper {
        margin: 24px auto;
        border-radius: 16px;
        overflow: hidden;
      }
    }

    .hidden { 
      display: none; 
    }

    /* HEADER */
    header {
      background: linear-gradient(135deg, #0f3b7a, #1d4ed8);
      color: #ffffff;
      padding: 2.5rem 1.5rem;
      text-align: center;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.35);
      position: relative;
    }

    header .header-inner {
      max-width: 900px;
      margin: 0 auto;
      position: relative;
    }

    #langSelect {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      padding: 0.35rem 0.75rem;
      font-size: 0.9rem;
      border: 1px solid rgba(226, 232, 240, 0.8);
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      color: #e5e7eb;
      cursor: pointer;
      text-align: center;
      text-align-last: center;
      -moz-text-align-last: center;
      -ms-text-align-last: center;
      backdrop-filter: blur(8px);
    }

    #langSelect option {
      color: #111827;
      background: #ffffff;
    }

    header img {
      height: 160px;
      max-width: 100%;
      object-fit: contain;
      margin-bottom: 0.75rem;
      filter: drop-shadow(0 10px 25px rgba(15, 23, 42, 0.35));
    }

    h1 {
      margin-top: 0;
      color: #ffffff;
      font-weight: 700;
      font-size: 2.2rem;
      line-height: 1.3;
      letter-spacing: 0.02em;
    }

    header p {
      font-size: 1.05rem;
      opacity: 0.95;
      margin: 0.3rem 0 0.5rem;
    }

    #supported {
      text-align: center;
      margin: 1.25rem 0 0.75rem;
    }

    #supported p {
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.9;
    }

    .fixed-logo {
      width: 110px;
      margin: 0 10px;
      vertical-align: middle;
      filter: drop-shadow(0 4px 10px rgba(15, 23, 42, 0.4));
      background: rgba(255,255,255,0.08);
      padding: 4px 8px;
      border-radius: 10px;
    }

    #btnMyApps {
      margin-top: 1.5rem;
      background: rgba(255,255,255,0.10);
      color: #e5edff;
      border: 1px solid rgba(191, 219, 254, 0.6);
      padding: 0.55rem 1.6rem;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 8px 18px rgba(15,23,42,0.25);
      font-size: 0.95rem;
    }

    #btnMyApps:hover {
      background: #ffffff;
      color: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 12px 26px rgba(15,23,42,0.32);
    }

    /* MAIN CONTENT */
    .main-content {
      padding: 2rem 2.5rem 2.5rem;
      flex: 1;
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 1.5rem 1.25rem 2rem;
      }
    }

    h2 {
      color: var(--dark);
      font-weight: 600;
      font-size: 1.7rem;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 10px;
      margin-top: 0;
    }

    /* CARDS */
    .card-container {
      display: flex;
      gap: 24px;
      justify-content: center;
      margin: 32px 0 8px;
      flex-wrap: wrap;
    }

    .card {
      flex: 1;
      min-width: 260px;
      max-width: 360px;
      padding: 1.6rem 1.4rem;
      border-radius: 14px;
      text-align: center;
      font-size: 1.05rem;
      color: var(--dark);
      cursor: pointer;
      transition: all 0.25s ease;
      min-height: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      background: radial-gradient(circle at top left, #eef2ff 0, #ffffff 45%);
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(209, 213, 219, 0.7);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(96,165,250,0.15), transparent 55%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%; 
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.3s ease-out;
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: var(--card-shadow-hover);
      border-color: rgba(59, 130, 246, 0.35);
      background-position: bottom right;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card:hover::after {
      transform: scaleX(1);
      transform-origin: left;
    }

    .card h3 {
      font-weight: 600;
      margin-bottom: 0.4rem;
      color: var(--dark);
      font-size: 1.15rem;
    }

    .card p {
      color: var(--muted);
      font-size: 0.95rem;
      margin: 0;
    }

    .small-card {
      flex: 0 0 auto;
      min-width: 200px;
      max-width: 260px;
      padding: 1.2rem 1rem;
      font-size: 1rem;
    }

    .small-card h3 {
      font-size: 1rem;
      margin: 0 0 4px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #1e293b;
    }

    .small-card p {
      margin: 0;
      color: #6b7280;
      font-size: 0.9rem;
    }

    /* FORMS */
    .form-container {
      background: linear-gradient(135deg, #f9fafb 0, #ffffff 40%, #eef2ff 100%);
      border-radius: 14px;
      padding: 28px 24px 24px;
      margin-top: 26px;
      border: 1px solid #e0e7ff;
      box-shadow: 0 14px 35px rgba(15,23,42,0.10);
    }

    form { 
      max-width: 640px; 
      margin: 0 auto; 
    }

    label {
      display: block;
      margin: 16px 0 6px;
      font-weight: 500;
      color: var(--dark);
      font-size: 0.92rem;
    }

    input, select {
      width: 100%;
      padding: 0.72rem 0.9rem;
      margin-bottom: 0.5rem;
      font-size: 0.96rem;
      border: 1px solid #d1d5db;
      border-radius: 9px;
      background: #ffffff;
      transition: all 0.2s ease-out;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 1px rgba(59,130,246,0.45);
      background: #ffffff;
    }

    input::placeholder {
      color: #9ca3af;
    }

    button {
      width: 100%;
      padding: 0.9rem 1.2rem;
      margin: 18px 0 4px;
      background: linear-gradient(135deg, #1d4ed8, #2563eb);
      color: white;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.98rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      transition: all 0.25s ease;
      box-shadow: 0 16px 35px rgba(37, 99, 235, 0.40);
      position: relative;
      overflow: hidden;
      border: 2px solid transparent;
      text-transform: uppercase;
    }

    button:hover {
      background: linear-gradient(135deg, #2563eb, #60a5fa);
      transform: translateY(-1px);
      box-shadow: 0 20px 45px rgba(37, 99, 235, 0.45);
      border-color: rgba(255,255,255,0.18);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(15,23,42,0.20);
    }

    .back-btn {
      background: #ffffff;
      border: 1px solid #d1d5db;
      color: #1d4ed8;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.45rem 0.95rem;
      border-radius: 999px;
      margin-bottom: 18px;
      transition: all 0.2s ease;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-transform: none;
      width: auto;
      box-shadow: 0 6px 16px rgba(15,23,42,0.10);
    }

    .back-btn:hover {
      background: #eff6ff;
      border-color: #93c5fd;
      color: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15,23,42,0.16);
    }

    /* Submit disabled state */
    #submitBtn:disabled {
      background: #e5e7eb;
      color: #6b7280;
      cursor: not-allowed;
      opacity: 0.85;
      box-shadow: none;
      border-color: transparent;
    }

    #submitBtn:not(:disabled) {
      background: linear-gradient(135deg, #1d4ed8, #2563eb);
      color: white;
      cursor: pointer;
    }

    #acceptTerms {
      margin-right: 3px;
    }

    #termsLink {
      margin-left: 0;
      text-decoration: underline;
      color: var(--primary);
    }

    /* TABLES */
    #myAppsSection table, 
    #certifiedSection table {
      width: 100%; 
      border-collapse: separate; 
      border-spacing: 0;
      margin-top: 22px; 
      background: #ffffff; 
      border-radius: 12px;
      overflow: hidden; 
      box-shadow: 0 16px 35px rgba(15,23,42,0.08);
      font-size: 0.92rem;
    }

    #myAppsSection th, #myAppsSection td,
    #certifiedSection th, #certifiedSection td {
      border-bottom: 1px solid #e5e7eb; 
      padding: 10px 14px; 
      text-align: left;
      white-space: nowrap;
    }

    #myAppsSection th, 
    #certifiedSection th {
      background: linear-gradient(90deg, #1d4ed8, #2563eb); 
      color: #f9fafb; 
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.78rem;
    }

    #myAppsSection tr:hover td, 
    #certifiedSection tr:hover td {
      background: #f9fafb;
    }

    #statusResult {
      background: #f9fafb;
      border-radius: 10px;
      padding: 18px;
      border-left: 4px solid var(--secondary);
      font-size: 0.95rem;
    }

    #statusResult strong {
      display: inline-block; 
      min-width: 90px; 
      color: var(--dark);
    }

    /* DOCS LIST */
    #docsList ul { 
      list-style: none; 
      padding-left: 0; 
    }

    #docsList li { 
      margin: 6px 0; 
    }

    #docsList a {
      color: var(--primary);
      text-decoration: none;
      font-size: 0.95rem;
    }

    #docsList a:hover {
      text-decoration: underline;
    }

    /* CERTIFIED FILTERS */
    #certifiedSection .filter-options {
      display: flex; 
      flex-wrap: wrap; 
      gap: 10px; 
      margin: 14px 0 10px;
      font-size: 0.88rem;
    }

    #certifiedSection .filter-options label {
      flex: 1; 
      min-width: 160px; 
      font-size: 0.86rem;
    }

    /* GALLERY */
    #gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      width: 92%;
      max-width: 900px;
      margin: 10px auto 24px;
    }

    #gallery img {
      width: 100%;
      height: auto;
      object-fit: contain;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      background: #ffffff;
    }

    .frame {
      width: 100%;
      height: 200px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      background: #ffffff;
      box-shadow: 0 10px 25px rgba(15,23,42,0.10);
    }

    .frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* GDPR BOX */
    #gdprMessage {
      margin-top: 26px; 
      padding: 18px 18px 16px; 
      background:#f9fafb;
      border-radius: 12px; 
      border-left:4px solid var(--secondary);
      box-shadow: 0 10px 24px rgba(15,23,42,0.06);
      font-size: 0.95rem;
    }

    #gdprMessage strong {
      display: block;
      margin-bottom: 8px;
    }

    #gdprMessage ul {
      margin: 0 0 6px 1.1rem;
      padding-left: 0;
    }

    #gdprMessage li {
      margin-bottom: 3px;
    }

    /* FOOTER */
    footer.site-footer {
      padding: 1.4rem 1.5rem;
      text-align: center;
      color: var(--muted);
      background: #f3f4f6;
      border-top: 1px solid rgba(148,163,184,0.45);
      font-size: 0.9rem;
    }

    footer.site-footer span {
      display: inline-block;
      padding-top: 2px;
    }

    /* RESPONSIVE TWEAKS */
    @media (max-width: 900px) {
      header {
        padding: 2.1rem 1.2rem 2rem;
      }
      h1 {
        font-size: 1.9rem;
      }
      header img {
        height: 135px;
      }
    }

    @media (max-width: 768px) {
      .wrapper {
        margin: 0;
        border-radius: 0;
      }

      #langSelect {
        font-size: 0.8rem;
        padding: 0.3rem 0.7rem;
      }

      h1 {
        font-size: 1.7rem;
      }

      header p {
        font-size: 0.95rem;
      }

      .card-container {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
        margin: 24px 0;
      }

      .card,
      .small-card {
        min-width: 100%;
        max-width: 100%;
      }

      #gallery {
        width: 100%;
        padding: 0 1rem 1.5rem;
      }

      #myAppsSection table,
      #certifiedSection table {
        font-size: 0.85rem;
        display: block;
        overflow-x: auto;
      }
    }

    @media (max-width: 480px) {
      header img {
        height: 120px;
      }
      .main-content {
        padding: 1.25rem 1rem 1.75rem;
      }
      #gdprMessage {
        font-size: 0.9rem;
      }
      .form-container {
        padding: 22px 16px 18px;
      }
    }
  </style>

  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
  <div class="wrapper">

    <header>
      <div class="header-inner">
        <div style="position: relative;">
          <!-- LANGUAGE SWITCHER -->
          <select id="langSelect">
            <option value="http://localhost:3000/" selected>--------Македонски--------</option>
            <option value="http://localhost:3000/en.html">English</option>
            <option value="http://localhost:3000/al.html">Shqip</option>
          </select>
        </div>

        <img src="/logo.jpg" alt="DIAB-REG Logo">

        <h1>Систем за стандардизирани потврди и регулација</h1>
        <p>на производи наменети за сите лица со дијабетес</p>
		
        <div id="supported">
          <p>Поддржано од:</p>
          <img
            class="fixed-logo"
            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTbBMbxYIyarbBG_HV1F3IABrK05X1i3zJHUA&s"
            alt="Лого 1"
          >
          <img
            class="fixed-logo"
            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS1cPOdSQDz5IeQzb7-284mp2ndLup06Ks6Cw&s"
            alt="Лого 2"
          >
        </div>

        <button id="btnMyApps" class="hidden">
          Мои апликации
        </button>
      </div>
    </header>

    <div class="main-content">

      <!-- Initial Section -->
      <div id="initialSection">
        <div style="text-align:center; margin-bottom:16px;">
          <div id="btnCertified" class="card small-card">
            <h3>Потврдени</h3>
            <p>од DIAB-REG</p>
          </div>
        </div>

        <div class="card-container">
          <div id="showLoginBtn" class="card">
            <h3>Најави се</h3>
            <p>Имате профил?</p>
          </div>
          <div id="showRegisterBtn" class="card">
            <h3>Регистрирај се</h3>
            <p>Нов корисник?</p>
          </div>
        </div>

        <div class="card-container">
          <div id="btnDocs" class="card small-card">
            <h3>Документи</h3>
            <p>и регулативи</p>
          </div>
          <div id="showPriceBtn" class="card small-card">
            <h3>Ценовник</h3>
          </div>
        </div>

        <div id="gdprMessage">
          <strong>DIAB-REG собира, обработува и чува само податоци кои се однесуваат на правни субјекти:</strong>
          <ul>
            <li>Назив на компанија</li>
            <li>ЕМБС</li>
            <li>Назив на производ</li>
            <li>Категорија</li>
            <li>Датум</li>
          </ul>
          <p>Без лични податоци. Нема колачиња за следење.</p>
        </div>

        <div id="docsList" style="margin-top:20px;"></div>
      </div>

      <!-- Сертифицирани барања -->
      <div id="certifiedSection" class="hidden">
        <button id="backFromCertified" class="back-btn">&larr; Назад</button>
        <h2>Барања за стандардизирана потврда</h2>
        <div class="filter-options">
          <label>ID: <input type="text" id="filterIdCert" placeholder="Filter по ID"/></label>
          <label>Created At: <input type="text" id="filterDateCert" placeholder="Filter по Датум"/></label>
          <label>Company: <input type="text" id="filterCompanyCert" placeholder="Filter по Компанија"/></label>
          <label>Product: <input type="text" id="filterProductCert" placeholder="Filter по Продукт"/></label>
          <label>Status:  <input type="text" id="filterStatusCert" value="Completed" disabled/></label>
        </div>
        <table>
          <thead>
            <tr>
              <th>ID</th><th>Created At</th><th>Company</th><th>Product</th>
              <th>Contact</th><th>Email</th><th>Status</th><th>Conf. No.</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Login Section -->
      <div id="loginSection" class="hidden">
        <button id="backFromLogin" class="back-btn">&larr; Врати се на почеток</button>
        <div class="form-container">
          <h2>Најава</h2>
          <form id="loginForm">
            <label>Матичен број (ЕМБС)</label>
            <input type="text" id="loginMat" required placeholder="Внесете го вашиот матичен број"/>
            <label>Лозинка</label>
            <input type="password" id="loginPass" required placeholder="Внесете ја вашата лозинка"/>
            <button type="submit">Најави се</button>
          </form>
        </div>
      </div>

      <!-- Registration Section -->
      <div id="registerSection" class="hidden">
        <button id="backFromRegister" class="back-btn">&larr; Врати се на почеток</button>
        <div class="form-container">
          <h2>Регистрација</h2>
          <form id="registerForm">
            <label>Матичен број (ЕМБС)</label>
            <input type="text" name="matichen_broj" required/>

            <label>Име на компанија</label>
            <input type="text" name="name" required/>

            <label>Е-пошта</label>
            <input type="email" name="email" required/>

            <label>Лозинка</label>
            <input type="password" name="password" id="password" required/>

            <button type="submit" id="registerBtn">Регистрирај се</button>
          </form>
        </div>
      </div>

      <!-- After Login Section -->
      <div id="afterLoginSection" class="hidden">
        <button id="backFromAfterLogin" class="back-btn">&larr; Одјави се</button>
        <div class="form-container">
          <h2>Добредојдовте!</h2>
          <p>Можете да поднесувате апликации и да ги проверувате сертификатите.</p>

          <!-- Application Form -->
          <div id="applySection" style="margin-top:26px;">
            <h3>Поднеси нова апликација</h3>
            <form id="applicationForm" action="/apply-and-pay" method="POST" enctype="multipart/form-data">
              <label>Контакт лице</label>
              <input type="text" name="contact" required/>
              <label>Контакт е-пошта</label>
              <input type="email" name="email" required/>
              <label>Категорија</label>
              <select name="category" id="categorySelect" required>
                <option value="">– Избери –</option>
                <option value="Додатоци и потрошен материјал">Додатоци и потрошен материјал (45 €)</option>
                <option value="Потрошен материјал за мерење/инјектирање">Потрошен материјал за мерење/инјектирање (65 €)</option>
                <option value="Уреди за мерење">Уреди за мерење (125 €)</option>
                <option value="Уреди за апликација на инсулин">Уреди за апликација на инсулин (170 €)</option>
                <option value="Автоматизирани системи">Автоматизирани системи (260 €)</option>
              </select>
              <label>Име на продукт</label>
              <input type="text" name="product" required/>
              <label>Прикачете документи</label>
              <input type="file" name="docs" multiple required/>
              <label style="display:flex; align-items:center; gap:8px; margin-top:1rem;">
                <input type="checkbox" id="acceptTerms" />
                <a href="/uslov/uslov.pdf" id="termsLink" target="_blank">
                  Ги прифаќам условите за наплата по фактура согласно DIAB-REG
                </a>
              </label>

              <button id="submitBtn" type="submit" disabled>Поднеси Апликација</button>
            </form>
          </div>

          <!-- Status Check -->
          <div id="statusSection" class="hidden" style="margin-top:32px;">
            <hr/>
            <h3>Проверка статус</h3>
            <div style="display:flex; gap:10px; align-items:center; margin-top:15px;">
              <input type="text" id="statusId" placeholder="Внесете ID на апликација" style="flex:1;"/>
              <button id="checkBtn" style="width:auto; padding:0 20px;">Провери</button>
            </div>
            <div id="statusResult" style="margin-top:20px;"></div>
            <button id="backFromStatus" class="back-btn" style="margin-top:20px;">&larr; Назад</button>
          </div>

          <!-- Docs & Price in After-Login too -->
          <div style="margin-top:26px; text-align:center;">
            <button id="btnDocs" style="margin-right:12px; width:180px;">Документи и регулативи</button>
            <button id="showPriceBtn" style="width:140px;">Ценовник</button>
          </div>
          <div id="docsList" style="margin-top:20px;"></div>

          <div style="margin-top:26px; line-height:1.5; font-size:0.95rem;">
            <p><strong>DIAB-REG собира, обработува и чува само податоци кои се однесуваат на правни субјекти:</strong></p>
            <ul>
              <li>Назив на компанија</li>
              <li>ЕМБС</li>
              <li>Назив на производ</li>
              <li>Категорија</li>
              <li>Датум</li>
            </ul>
            <p>Без лични податоци. Нема колачиња за следење.</p>
          </div>
        </div>
      </div>

      <!-- My Applications Section -->
      <div id="myAppsSection" class="hidden">
        <button id="backFromMyApps" class="back-btn">&larr; Назад</button>
        <h2>Мои апликации</h2>
        <table>
          <thead>
            <tr>
              <th>ID</th><th>Датум</th><th>Продукт</th><th>Статус</th>
              <th>Conf. No.</th><th>Преглед</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </div>

    <div id="gallery"></div>

    <footer class="site-footer">
      <span>© 2025 DIAB-REG Систем за стандардизирани потврди. Сите права се задржани.</span>
    </footer>
  </div>

  <script>
    const images = [
      'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSQhyHn4MpY9UEEmWgfjxVh3JAqXveq9_2wZw&s',
      'https://upload.wikimedia.org/wikipedia/en/b/b1/Novo_Nordisk_-_Logo.svg',
      'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/F._Hoffmann-La_Roche_2021_logo.svg/1200px-F._Hoffmann-La_Roche_2021_logo.svg.png',
      'https://farmaon.al/wp-content/uploads/2023/04/e22bd229-helathyl08-favio-forte.jpg'
    ];

    document.addEventListener('DOMContentLoaded', () => {
      // attach language switcher
      const langSelect = document.getElementById('langSelect');
      langSelect.addEventListener('change', e => {
        window.location.href = e.target.value;
      });
    });

    const gallery = document.getElementById('gallery');
    const translations = {
      mk: { /* (оставено исто како кај тебе – скратено тука за јасност) */ },
      en: { /* ... */ },
      sq: { /* ... */ }
    };
	
    // Прикажи ги сликите во рамки
    function renderGallery() {
      gallery.innerHTML = '';
      images.forEach(src => {
        const frame = document.createElement('div');
        frame.className = 'frame';
        const img = document.createElement('img');
        img.src = src;
        frame.appendChild(img);
        gallery.appendChild(frame);
      });
    }

    // Fisher–Yates shuffle
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Прво рендерирање
    renderGallery();

    // Меша и рендерира секои 15 секунди
    setInterval(() => {
      shuffleArray(images);
      renderGallery();
    }, 15000);
  
    let token = null;
    const initial    = document.getElementById('initialSection');
    const certified  = document.getElementById('certifiedSection');
    const loginSec   = document.getElementById('loginSection');
    const regSec     = document.getElementById('registerSection');
    const after      = document.getElementById('afterLoginSection');
    const myAppsSec  = document.getElementById('myAppsSection');
    const docsList   = document.getElementById('docsList');

    const form         = document.getElementById('applicationForm');
    const submitBtn    = document.getElementById('submitBtn');
    const acceptTerms  = document.getElementById('acceptTerms');
    const requiredEls  = [
      document.getElementById('contactInput'),
      document.getElementById('emailInput'),
      document.getElementById('categorySelect'),
      document.getElementById('productInput'),
      document.getElementById('docsInput')
    ];

    function updateSubmitState() {
      const allFilled = requiredEls.every(el => {
        if (!el) return false;
        if (el.type === 'file') {
          return el.files.length > 0;
        }
        return el.value.trim() !== '';
      });
      submitBtn.disabled = !(allFilled && acceptTerms.checked);
    }

    acceptTerms.addEventListener('change', () => {
      submitBtn.disabled = !acceptTerms.checked;
    });

    form.addEventListener('submit', async e => {
      e.preventDefault();
      if (!token) return alert('Мора да се најавиш');
      if (!acceptTerms.checked) return alert('Мора да ги прифатите условите');

      const fd = new FormData(form);
      const applyRes  = await fetch('/api/apply', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + token },
        body: fd
      });
      const applyJson = await applyRes.json();
      if (!applyJson.id) {
        return alert('Грешка при поднесување: ' + (applyJson.error||''));
      }

      alert('Апликацијата е поднесена! Вашето ID е ' + applyJson.id);
    });

    form.addEventListener('submit', e => {
      e.preventDefault();
      if (!token) return alert('Мора да се најавиш');

      // Овој дел е оставен како во оригиналниот фајл
      // (ако го користиш Stripe, тука ги додадеш променливите formData, category, link)
      /*
      const formData = new FormData(form);
      const category = formData.get('category');

      sessionStorage.setItem('appData', JSON.stringify({
        contact: formData.get('contact'),
        email:   formData.get('email'),
        product: formData.get('product'),
        category
      }));

      const link = PAYMENT_LINKS[category];
      window.location.href = link;
      */
    });

    // Навигација
    document.getElementById('showLoginBtn').onclick       = ()=>{
      initial.classList.add('hidden');
      loginSec.classList.remove('hidden');
    };
    document.getElementById('backFromLogin').onclick      = ()=>{
      loginSec.classList.add('hidden');
      initial.classList.remove('hidden');
    };
    document.getElementById('showRegisterBtn').onclick    = ()=>{
      initial.classList.add('hidden');
      regSec.classList.remove('hidden');
    };
    document.getElementById('backFromRegister').onclick   = ()=>{
      regSec.classList.add('hidden');
      initial.classList.remove('hidden');
    };
    document.getElementById('backFromAfterLogin').onclick = ()=>{
      token = null;
      after.classList.add('hidden');
      initial.classList.remove('hidden');
    };
    document.getElementById('backFromStatus').onclick     = ()=>{
      document.getElementById('statusSection').classList.add('hidden');
      after.classList.remove('hidden');
    };
    document.getElementById('backFromMyApps').onclick     = ()=>{
      myAppsSec.classList.add('hidden');
      after.classList.remove('hidden');
    };
    document.getElementById('backFromCertified').onclick  = ()=>{
      certified.classList.add('hidden');
      initial.classList.remove('hidden');
    };

    // Сертифицирани од DIAB-REG
    document.getElementById('btnCertified').addEventListener('click', async ()=>{
      initial.classList.add('hidden');
      certified.classList.remove('hidden');

      const res = await fetch('/api/admin/applications', { credentials: 'include' });

      if (!res.ok) return alert('Грешка при вчитување');

      const apps = (await res.json()).filter(x=>x.status==='Completed');
      const tb = certified.querySelector('tbody');
      tb.innerHTML = apps.map(a=>{
        const d = new Date(a.createdAt).toLocaleString('mk-MK');
        return `<tr>
          <td>${a._id}</td><td>${d}</td><td>${a.company.name}</td>
          <td>${a.product}</td><td>${a.contact}</td><td>${a.email}</td>
          <td>${a.status}</td><td>${a.cert_number||''}</td>
        </tr>`;
      }).join('');
    });

    function applyCertFilters(){
      const f={
        id:      document.getElementById('filterIdCert').value.toLowerCase(),
        date:    document.getElementById('filterDateCert').value.toLowerCase(),
        company: document.getElementById('filterCompanyCert').value.toLowerCase(),
        product: document.getElementById('filterProductCert').value.toLowerCase()
      };
      certified.querySelectorAll('tbody tr').forEach(r=>{
        const c = Array.from(r.cells).map(td=>td.textContent.toLowerCase());
        const ok =
          (!f.id      || c[0].includes(f.id))&&
          (!f.date    || c[1].includes(f.date))&&
          (!f.company || c[2].includes(f.company))&&
          (!f.product || c[3].includes(f.product));
        r.style.display = ok?'':'none';
      });
    }
    ['filterIdCert','filterDateCert','filterCompanyCert','filterProductCert']
      .forEach(id=>document.getElementById(id).addEventListener('input',applyCertFilters));

    // Документи и регулативи
    document.getElementById('btnDocs').addEventListener('click', async () => {
      try {
        const res  = await fetch('/api/documents');
        if (!res.ok) throw new Error();
        const json = await res.json();
        const docsHtml = json.files
          .map(f => `<li><a href="/documents/${encodeURIComponent(f)}" target="_blank">${f}</a></li>`)
          .join('');
        const popup = window.open('', 'docsPopup', 'width=600,height=400');
        popup.document.write(`
          <!DOCTYPE html>
          <html lang="mk">
          <head>
            <meta charset="UTF-8"/>
            <title>Документи и регулативи</title>
            <style>
              body { font-family: 'Segoe UI', sans-serif; padding:20px; }
              h3 { color: #1d4ed8; }
              ul { list-style: none; padding-left: 0; }
              li { margin: 8px 0; }
              a { color: #1d4ed8; text-decoration: none; }
              a:hover { text-decoration: underline; }
            </style>
          </head>
          <body>
            <h3>Документи и регулативи</h3>
            <ul>${docsHtml}</ul>
          </body>
          </html>
        `);
      } catch (e) {
        alert('Грешка при вчитување документи');
      }
    });

    // Ценовник
    document.getElementById('showPriceBtn').addEventListener('click', ()=>{
      const priceTable = `
        <h3>Ценовник на сертификати (МКД)</h3>
        <table border="1" cellpadding="5" cellspacing="0" style="border-collapse:collapse;margin:10px auto;">
          <thead><tr><th>Категорија</th><th>Примери</th><th>Цена(МКД)</th></tr></thead>
          <tbody>
            <tr><td>Додатоци и потрошен материјал</td><td>Лепенки, налепници, носачи</td><td>2500</td></tr>
            <tr><td>Потрошен материјал за мерење/инјектирање</td><td>Тест ленти, игли, катетри</td><td>4000</td></tr>
            <tr><td>Уреди за мерење</td><td>Глукометри, CGM, сензори</td><td>7500</td></tr>
            <tr><td>Уреди за апликација на инсулин</td><td>Инсулински пенкала, Jet injectors</td><td>10000</td></tr>
            <tr><td>Автоматизирани системи</td><td>Инсулински пумпи, хибридни системи</td><td>15000</td></tr>
          </tbody>
        </table>`;
      const w = window.open('','price','width=600,height=400');
      w.document.write(`<html><body>${priceTable}</body></html>`);
    });

    // Регистрација
    document.getElementById('registerForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());
      const res  = await fetch('/api/auth/register',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(data)
      });
      const json = await res.json();
      if(json.success){
        alert('Регистрација успешна!');
        regSec.classList.add('hidden');
        loginSec.classList.remove('hidden');
      } else alert('Грешка: '+(json.error||''));
    });

    // Логин
    document.getElementById('loginForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const body = {
        matichen_broj: document.getElementById('loginMat').value,
        password:      document.getElementById('loginPass').value
      };
      const res = await fetch('/api/auth/login',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(body)
      });
      const json = await res.json();
      if(json.token){
        token = json.token;
        alert('Најавa успешна!');
        loginSec.classList.add('hidden');
        after.classList.remove('hidden');
        document.getElementById('btnMyApps').classList.remove('hidden');
      } else alert('Login failed: '+(json.error||''));
    });

    // Проверка статус
    document.getElementById('checkBtn').addEventListener('click', async () => {
      const id  = document.getElementById('statusId').value;
      const res = await fetch('/api/status/'+encodeURIComponent(id), {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      const json= await res.json();
      const r   = document.getElementById('statusResult');

      if (!json.found) {
        r.innerText = 'Не пронајдено.';
      } else {
        const { status, company, cert_number } = json.application;
        r.innerHTML = 
          `<strong>ID:</strong> ${id}<br>
           <strong>Статус:</strong> ${status}<br>
           <strong>Company:</strong> ${company}` +
          (status === 'Completed' && cert_number
            ? `<br><br>
               <a href="/confirm/${encodeURIComponent(cert_number)}" target="_blank">
                 Преглед на сертификат ${cert_number}
               </a>`
            : '');
      }

      document.getElementById('applySection').classList.add('hidden');
      document.getElementById('statusSection').classList.remove('hidden');
    });

    document.getElementById('backFromStatus').addEventListener('click', () => {
      document.getElementById('statusSection').classList.add('hidden');
      document.getElementById('applySection').classList.remove('hidden');
    });

    // Мои апликации
    document.getElementById('btnMyApps').addEventListener('click', async ()=>{
      if(!token) return alert('Мора да се најавиш');
      after.classList.add('hidden');
      myAppsSec.classList.remove('hidden');
      const res = await fetch('/api/my/applications',{headers:{'Authorization':'Bearer '+token}});
      if(!res.ok) return alert('Грешка при вчитување апликации');
      const apps = await res.json();
      const tb = myAppsSec.querySelector('tbody');
      tb.innerHTML = apps.map(app=>{
        const d = new Date(app.createdAt).toLocaleString('mk-MK');
        const cert = app.cert_number ? `<a href="/confirm/${encodeURIComponent(app.cert_number)}">${app.cert_number}</a>` : '-';
        const view = app.cert_number ? `<a href="/confirm/${encodeURIComponent(app.cert_number)}">Преглед</a>` : '-';
        return `<tr><td>${app._id}</td><td>${d}</td><td>${app.product}</td><td>${app.status}</td><td>${cert}</td><td>${view}</td></tr>`;
      }).join('');
    });
	
    function updateUIForAuth() {
      if (token) {
        document.getElementById('btnMyApps').classList.remove('hidden');
      } else {
        document.getElementById('btnMyApps').classList.add('hidden');
      }
    }

    // пример од оригиналниот код (оставен како референца)
    // token = json.token;
    // updateUIForAuth();
    token = localStorage.getItem('jwtToken');
    updateUIForAuth();

    document.addEventListener('DOMContentLoaded', () => {
      const acceptTerms = document.getElementById('acceptTerms');
      const submitBtn   = document.getElementById('submitBtn');

      submitBtn.disabled = true;

      acceptTerms.addEventListener('change', () => {
        submitBtn.disabled = !acceptTerms.checked;
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      const termsLink = document.getElementById('termsLink');
      termsLink.addEventListener('click', e => {
        e.preventDefault();
        window.open(
          '/uslov.pdf',
          'UsloviPDF',
          'width=800,height=600,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes'
        );
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      const form        = document.getElementById('registerForm');
      const pwdInput    = document.getElementById('password');
      const registerBtn = document.getElementById('registerBtn');

      form.addEventListener('submit', async e => {
        e.preventDefault();

        const confirmation = prompt('Ве молам потврдете ја лозинката што ја внeвте:');
        if (confirmation === null) {
          return;
        }

        if (confirmation !== pwdInput.value) {
          alert('Грешка: лозинките не се совпаѓаат!');
          return;
        }

        const data = {
          matichen_broj: form.elements.matichen_broj.value.trim(),
          name:          form.elements.name.value.trim(),
          email:         form.elements.email.value.trim(),
          password:      pwdInput.value
        };

        try {
          const res  = await fetch('/api/auth/register', {
            method:  'POST',
            headers: { 'Content-Type': 'application/json' },
            body:    JSON.stringify(data)
          });
          const json = await res.json();

          if (json.success) {
            alert('Регистрацијата е успешна!');
            document.getElementById('registerSection').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
          } else {
            alert('Грешка при регистрација: ' + (json.error||'Непозната грешка'));
          }
        } catch (err) {
          alert('Грешка при регистрација: ' + err.message);
        }
      });
    });

    document.getElementById('langSelect').addEventListener('change', function() {
      window.location.href = this.value;
    });
  </script>
</body>
</html>
