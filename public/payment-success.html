<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8">
  <title>Успешно плаќање</title>
</head>
<body>
  <h1>Плаќањето е примено</h1>
  <p id="msg">Се проверува статусот...</p>
<BR><BR>
 <a class="button" href="https://diabreg.onrender.com">
      ↩ Врати се на DIAB-REG
    </a>
  <script>
    (async () => {
      const params = new URLSearchParams(window.location.search);
      const sessionId = params.get('session_id');

      if (!sessionId) {
        document.getElementById('msg').innerText = 'Недостасува session_id.';
        return;
      }

      try {
        const res  = await fetch('/api/pay/confirm?session_id=' + encodeURIComponent(sessionId));
        const json = await res.json();
        if (json.success) {
          document.getElementById('msg').innerText =
            'Плаќањето е успешно. Вашата апликација (ID: ' + json.applicationId + ') е евидентирана.';
        } else {
          document.getElementById('msg').innerText =
            'Плаќањето не може да се потврди: ' + (json.error || '');
        }
      } catch (e) {
        console.error(e);
        document.getElementById('msg').innerText = 'Грешка при поврзување со серверот.';
      }
    })();
  </script>
</body>
</html>
